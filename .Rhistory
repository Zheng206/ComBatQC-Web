visNetwork(nodes, edges, width = "100%", height = "420px") %>%
visOptions(highlightNearest = TRUE) %>%
visEdges(smooth = list(enabled = TRUE)) %>%
visPhysics(enabled = FALSE) %>%
visInteraction(hover = TRUE, tooltipDelay = 50) %>%  # enable hover tooltips
visEvents(
click = "
function(params){
// NODE clicks: show figure + (optionally) navigate
if(params.nodes && params.nodes.length){
var n = params.nodes[0];
var figDiv = document.getElementById('node-figure');
if(n == 1){
figDiv.innerHTML = '<img src=\"figures/workflow.png\" style=\"max-width:100%\">';
window.location.hash = '#unharmonized';
} else if(n == 2){
figDiv.innerHTML = '<img src=\"figures/diagnostic.png\" style=\"max-width:100%\">';
window.location.hash = '#diagnostic';
} else if(n == 3){
figDiv.innerHTML = '<img src=\"figures/harmonized.png\" style=\"max-width:100%\">';
window.location.hash = '#harmonized';
}
}
// EDGE clicks: show explanation
if(params.edges && params.edges.length){
var id = params.edges[0];
if(id === 'DtoH'){
alert('In-sample harmonization');
} else if(id === 'UtoH'){
alert('Both in-sample and out-of-sample harmonization');
}
}
}
"
)
library(tidyverse)
nodes <- data.frame(
id    = c(1, 2, 3),
label = c("Unharmonized Dataset",
"Interactive Batch Effect Diagnostic",
"Harmonized Dataset"),
title = c("Raw data before correction",
"Explore/visualize batch effects",
"After harmonization"),
x     = c(0, 200, 400),
y     = c(0, 160, 0)
)
edges <- data.frame(
id     = c("UtoD", "DtoH", "UtoH"),
from   = c(1, 2, 1),
to     = c(2, 3, 3),
dashes = c(FALSE, FALSE, TRUE),
arrows = "to",
title  = c(
"Unharmonized → Diagnostic",
"In-sample harmonization",
"Both in-sample and out-of-sample harmonization"
)
)
visNetwork(nodes, edges, width = "100%", height = "420px") %>%
visOptions(highlightNearest = TRUE) %>%
visEdges(smooth = list(enabled = TRUE)) %>%
visPhysics(enabled = FALSE) %>%
visInteraction(hover = TRUE, tooltipDelay = 50) %>%  # enable hover tooltips
visEvents(
click = "
function(params){
// NODE clicks: show figure + (optionally) navigate
if(params.nodes && params.nodes.length){
var n = params.nodes[0];
var figDiv = document.getElementById('node-figure');
if(n == 1){
figDiv.innerHTML = '<img src=\"figures/workflow.png\" style=\"max-width:100%\">';
window.location.hash = '#unharmonized';
} else if(n == 2){
figDiv.innerHTML = '<img src=\"figures/diagnostic.png\" style=\"max-width:100%\">';
window.location.hash = '#diagnostic';
} else if(n == 3){
figDiv.innerHTML = '<img src=\"figures/harmonized.png\" style=\"max-width:100%\">';
window.location.hash = '#harmonized';
}
}
// EDGE clicks: show explanation
if(params.edges && params.edges.length){
var id = params.edges[0];
if(id === 'DtoH'){
alert('In-sample harmonization');
} else if(id === 'UtoH'){
alert('Both in-sample and out-of-sample harmonization');
}
}
}
"
)
library(htmlwidgets)
nodes <- data.frame(
id    = c(1, 2, 3),
label = c("Unharmonized Dataset",
"Interactive Batch Effect Diagnostic",
"Harmonized Dataset"),
title = c("Raw data before correction",
"Explore/visualize batch effects",
"After harmonization"),
x     = c(0, 200, 400),
y     = c(0, 160, 0)
)
edges <- data.frame(
id     = c("UtoD", "DtoH", "UtoH"),
from   = c(1, 2, 1),
to     = c(2, 3, 3),
dashes = c(FALSE, FALSE, TRUE),
arrows = "to",
title  = c(
"Unharmonized → Diagnostic",
"In-sample harmonization",
"Both in-sample and out-of-sample harmonization"
)
)
visNetwork(nodes, edges, width = "100%", height = "420px") %>%
visOptions(highlightNearest = TRUE) %>%
visEdges(smooth = list(enabled = TRUE)) %>%
visPhysics(enabled = FALSE) %>%
visInteraction(hover = TRUE, tooltipDelay = 50) %>%  # enable hover tooltips
visEvents(
click = "
function(params){
// NODE clicks: show figure + (optionally) navigate
if(params.nodes && params.nodes.length){
var n = params.nodes[0];
var figDiv = document.getElementById('node-figure');
if(n == 1){
figDiv.innerHTML = '<img src=\"figures/workflow.png\" style=\"max-width:100%\">';
window.location.hash = '#unharmonized';
} else if(n == 2){
figDiv.innerHTML = '<img src=\"figures/diagnostic.png\" style=\"max-width:100%\">';
window.location.hash = '#diagnostic';
} else if(n == 3){
figDiv.innerHTML = '<img src=\"figures/harmonized.png\" style=\"max-width:100%\">';
window.location.hash = '#harmonized';
}
}
// EDGE clicks: show explanation
if(params.edges && params.edges.length){
var id = params.edges[0];
if(id === 'DtoH'){
alert('In-sample harmonization');
} else if(id === 'UtoH'){
alert('Both in-sample and out-of-sample harmonization');
}
}
}
"
)
library(visNetwork)
library(tidyverse)
library(htmlwidgets)
nodes <- data.frame(
id    = c(1, 2, 3),
label = c("Unharmonized Dataset",
"Interactive Batch Effect Diagnostic",
"Harmonized Dataset"),
title = c("Raw data before correction",
"Explore/visualize batch effects",
"After harmonization"),
x     = c(0, 200, 400),
y     = c(0, 160, 0)
)
edges <- data.frame(
id     = c("UtoD", "DtoH", "UtoH"),
from   = c(1, 2, 1),
to     = c(2, 3, 3),
dashes = c(FALSE, FALSE, TRUE),
arrows = "to",
title  = c(
"Unharmonized → Diagnostic",
"In-sample harmonization",
"Both in-sample and out-of-sample harmonization"
)
)
visNetwork(nodes, edges, width = "100%", height = "420px") %>%
visOptions(highlightNearest = TRUE) %>%
visEdges(smooth = list(enabled = TRUE)) %>%
visPhysics(enabled = FALSE) %>%
visInteraction(hover = TRUE, tooltipDelay = 50) %>%  # enable hover tooltips
visEvents(
click = "
function(params){
// NODE clicks: show figure + (optionally) navigate
if(params.nodes && params.nodes.length){
var n = params.nodes[0];
var figDiv = document.getElementById('node-figure');
if(n == 1){
figDiv.innerHTML = '<img src=\"figures/workflow.png\" style=\"max-width:100%\">';
window.location.hash = '#unharmonized';
} else if(n == 2){
figDiv.innerHTML = '<img src=\"figures/diagnostic.png\" style=\"max-width:100%\">';
window.location.hash = '#diagnostic';
} else if(n == 3){
figDiv.innerHTML = '<img src=\"figures/harmonized.png\" style=\"max-width:100%\">';
window.location.hash = '#harmonized';
}
}
// EDGE clicks: show explanation
if(params.edges && params.edges.length){
var id = params.edges[0];
if(id === 'DtoH'){
alert('In-sample harmonization');
} else if(id === 'UtoH'){
alert('Both in-sample and out-of-sample harmonization');
}
}
}
"
)
getwd()
visNetwork(nodes, edges, width = "100%", height = "420px") %>%
visOptions(highlightNearest = TRUE) %>%
visEdges(smooth = list(enabled = TRUE)) %>%
visPhysics(enabled = FALSE) %>%
visInteraction(hover = TRUE, tooltipDelay = 50) %>%  # enable hover tooltips
visEvents(
click = "
function(params){
// NODE clicks: show figure + (optionally) navigate
if(params.nodes && params.nodes.length){
var n = params.nodes[0];
var figDiv = document.getElementById('node-figure');
if(n == 1){
figDiv.innerHTML = '<img src=\"figure/workflow.png\" style=\"max-width:100%\">';
window.location.hash = '#unharmonized';
} else if(n == 2){
figDiv.innerHTML = '<img src=\"figure/diagnostic.png\" style=\"max-width:100%\">';
window.location.hash = '#diagnostic';
} else if(n == 3){
figDiv.innerHTML = '<img src=\"figure/harmonized.png\" style=\"max-width:100%\">';
window.location.hash = '#harmonized';
}
}
// EDGE clicks: show explanation
if(params.edges && params.edges.length){
var id = params.edges[0];
if(id === 'DtoH'){
alert('In-sample harmonization');
} else if(id === 'UtoH'){
alert('Both in-sample and out-of-sample harmonization');
}
}
}
"
)
# ---- Nodes (with fixed coordinates) ----
nodes <- data.frame(
id    = c(1, 2, 3, 4),
label = c(
"Unharmonized Dataset",
"Interactive Batch Effect Diagnostic",
"Harmonized Dataset",
"Post-harmonization Analysis"
),
title = c(
"Raw data before correction",
"Explore/visualize batch effects",
"After harmonization",
"Downstream analyses after harmonization"
),
x     = c(0, 220, 440, 660),
y     = c(0, 160, 0, 0)
)
# ---- Edges (include IDs for click handling + tooltips) ----
edges <- data.frame(
id     = c("UtoD","DtoH","UtoH","HtoP"),
from   = c(1, 2, 1, 3),
to     = c(2, 3, 3, 4),
dashes = c(FALSE, FALSE, TRUE, FALSE),  # U->H is dashed
arrows = "to",
title  = c(
"Unharmonized → Diagnostic",
"In-sample harmonization",
"Both in-sample and out-of-sample harmonization",
"Post-harmonization analysis"
)
)
visNetwork(nodes, edges, width = "100%", height = "420px") %>%
visOptions(highlightNearest = TRUE) %>%
visEdges(smooth = list(enabled = TRUE)) %>%
visPhysics(enabled = FALSE) %>%
visInteraction(hover = TRUE, tooltipDelay = 50) %>%
visEvents(
click = "
function(params){
var panel = document.getElementById('node-figure');
if(!panel){ return; }
// helper: build <img> tag safely relative to the page
function imgTag(rel){
var url = new URL(rel, document.baseURI);
return '<img src=\"' + url + '\" style=\"max-width:100%\">';
}
// Map node IDs -> image paths (adjust to your files)
var imgMap = {
1: 'figures/unharmonized.png',
2: 'figures/diagnostic.png',
3: 'figures/harmonized.png',
4: 'figures/post_harmonization.png'
};
// Node click: show figure
if(params.nodes && params.nodes.length){
var n = params.nodes[0];
if(imgMap[n]){
panel.innerHTML = imgTag(imgMap[n]);
} else {
panel.innerHTML = '<div style=\"padding:.5rem;\">No figure configured for node ' + n + '.</div>';
}
}
// Edge click: show explanation text
if(params.edges && params.edges.length){
var id = params.edges[0];
var msg = '';
if(id === 'DtoH'){
msg = 'In-sample harmonization';
} else if(id === 'UtoH'){
msg = 'Both in-sample and out-of-sample harmonization';
} else if(id === 'UtoD'){
msg = 'Pass data to diagnostic stage';
} else if(id === 'HtoP'){
msg = 'Proceed to post-harmonization analysis';
}
if(msg){
panel.innerHTML = '<div style=\"border:1px solid #ddd;padding:.75rem;border-radius:.25rem;\">' +
'<strong>Link explanation:</strong> ' + msg + '</div>';
}
}
}
"
)
visNetwork(nodes, edges, width = "100%", height = "420px") %>%
visOptions(highlightNearest = TRUE) %>%
visEdges(smooth = list(enabled = TRUE)) %>%
visPhysics(enabled = FALSE) %>%
visInteraction(hover = TRUE, tooltipDelay = 50) %>%
visEvents(
click = "
function(params){
var panel = document.getElementById('node-figure');
if(!panel){ return; }
// helper: build <img> tag safely relative to the page
function imgTag(rel){
var url = new URL(rel, document.baseURI);
return '<img src=\"' + url + '\" style=\"max-width:100%\">';
}
// Map node IDs -> image paths (adjust to your files)
var imgMap = {
1: 'figure/age_trend.png',
2: 'figure/toward.png',
3: 'figures/workflow.png',
4: 'figures/ComBatFamQC.png'
};
// Node click: show figure
if(params.nodes && params.nodes.length){
var n = params.nodes[0];
if(imgMap[n]){
panel.innerHTML = imgTag(imgMap[n]);
} else {
panel.innerHTML = '<div style=\"padding:.5rem;\">No figure configured for node ' + n + '.</div>';
}
}
// Edge click: show explanation text
if(params.edges && params.edges.length){
var id = params.edges[0];
var msg = '';
if(id === 'DtoH'){
msg = 'In-sample harmonization';
} else if(id === 'UtoH'){
msg = 'Both in-sample and out-of-sample harmonization';
} else if(id === 'UtoD'){
msg = 'Pass data to diagnostic stage';
} else if(id === 'HtoP'){
msg = 'Proceed to post-harmonization analysis';
}
if(msg){
panel.innerHTML = '<div style=\"border:1px solid #ddd;padding:.75rem;border-radius:.25rem;\">' +
'<strong>Link explanation:</strong> ' + msg + '</div>';
}
}
}
"
)
nodes <- data.frame(
id = c(1, 2, 3, 4),
label = c(
"Unharmonized Dataset",
"Interactive Batch Effect Diagnostic",
"Harmonized Dataset",
"Post-harmonization Analysis"
),
title = c(
"Raw data before correction",
"Explore/visualize batch effects",
"After harmonization",
"Downstream analyses after harmonization"
),
x = c(0, 220, 440, 660),
y = c(0, 160, 0, 0)
)
# ---- Edges (include IDs for click handling + tooltips) ----
edges <- data.frame(
id = c("UtoD","DtoH","UtoH","HtoP"),
from = c(1, 2, 1, 3),
to = c(2, 3, 3, 4),
dashes = c(FALSE, FALSE, TRUE, FALSE), # U->H is dashed
arrows = "to",
title = c(
"Unharmonized → Diagnostic",
"In-sample harmonization",
"Both in-sample and out-of-sample harmonization",
"Post-harmonization analysis"
)
)
visNetwork(nodes, edges, width = "100%", height = "420px") %>%
visOptions(highlightNearest = TRUE) %>%
visEdges(smooth = list(enabled = TRUE)) %>%
visPhysics(enabled = FALSE) %>%
visInteraction(hover = TRUE, tooltipDelay = 50) %>%
visEvents(
click = "
function(params){
var panel = document.getElementById('node-figure');
if(!panel){ return; }
// Simple loading state to avoid 'nothing happened' feel
function setLoading() {
panel.innerHTML = '<div style=\"padding:.75rem;opacity:.8;\">Loading…</div>';
}
// Build <img> with a fallback path if the first fails
function imgTag(primary, fallback){
var src1 = new URL(primary, document.baseURI);
var src2 = fallback ? new URL(fallback, document.baseURI) : null;
var onerr = src2
? 'this.onerror=null;this.src=\\'' + src2 + '\\';'
: 'this.onerror=null;this.replaceWith(document.createTextNode(\\'Image not found\\'));';
return '<img src=\"' + src1 + '\" style=\"max-width:100%\" onerror=\"' + onerr + '\">';
}
// Map node IDs -> [primaryPath, fallbackPath]
// Keep BOTH folder conventions you used (figure/ vs figures/) as primary/fallback.
var imgMap = {
1: ['figure/age_trend.png',        'figures/age_trend.png'],
2: ['figure/toward.png',            'figures/toward.png'],
3: ['figures/workflow.png',         'figure/workflow.png'],
4: ['figures/ComBatFamQC.png',      'figure/ComBatFamQC.png']
};
// NODE click -> show figure in panel
if(params.nodes && params.nodes.length){
var n = params.nodes[0];
if(imgMap[n]){
setLoading();
panel.innerHTML = imgTag(imgMap[n][0], imgMap[n][1]);
} else {
panel.innerHTML = '<div style=\"padding:.75rem;\">No figure configured for node ' + n + '.</div>';
}
}
// EDGE click -> show explanation text in panel
if(params.edges && params.edges.length){
var id = params.edges[0];
var msg = '';
if(id === 'DtoH'){
msg = 'In-sample harmonization';
} else if(id === 'UtoH'){
msg = 'Both in-sample and out-of-sample harmonization';
} else if(id === 'UtoD'){
msg = 'Pass data to diagnostic stage';
} else if(id === 'HtoP'){
msg = 'Proceed to post-harmonization analysis';
}
if(msg){
panel.innerHTML = '<div style=\"border:1px solid #ddd;padding:.75rem;border-radius:.25rem;\">' +
'<strong>Link explanation:</strong> ' + msg + '</div>';
}
}
}
"
)
