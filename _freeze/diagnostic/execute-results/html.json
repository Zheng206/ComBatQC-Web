{
  "hash": "06f0120c04ee485e94e746a788ba0844",
  "result": {
    "markdown": "---\ntitle: \"Batch Effect Diagnostics\"\nformat: html\n---\n\n\nIn this section, we will use a sample data included in this package to provide a thorough introduction to the key functionalities of the ComBatFamQC package for batch effect diagnostics.\n\n# Data\n___\n\nThe sample dataset in the package is the longitudinal cortical thickness data from the\n[Alzheimerâ€™s Disease Neuroimaging Initiative](https://adni.loni.usc.edu/\n) (ADNI) study (Jack et al. (2008)), which con-\ntains cortical thickness measures of 62 regions from 663 unique participants with images\ncollected longitudinally between 2-6 visits. The processed data can be downloaded from [GitHub](\nhttps://github.com/ntustison/CrossLong). \n\nThe key variables of interest are presented below:\n\n-   Batch variable: \n    -   <span style=\"color:blueviolet;\">*manufac*</span>: MRI manufacturer\n-   Covariates\n    -   <span style=\"color:darkseagreen;\">*timedays*</span>: time related variable\n    -   <span style=\"color:darkseagreen;\">*Age*</span>\n    -   <span style=\"color:darkseagreen;\">*SEX*</span> \n    -   <span style=\"color:darkseagreen;\">*DIAGNOSIS*</span>: (AD, CN, LMCI)\n    \n    (We consider an interaction effect between *timedays* and *DIAGNOSIS*)\n-   Features to harmonize\n    -   62 <span style=\"color:coral;\">cortical thickness</span> regions\n-   Random Effect\n    -   <span style=\"color:cornflowerblue;\">*subid*</span> : Subject IDs.\n\n# Interactive Batch Effect Diagnostics\n___\n\nUsers can launch the Shiny app using the following code:\n\n::: {.callout-note collapse=\"true\"}\n## R code\n\n::: {.cell}\n\n```{.r .cell-code}\nfeatures <- colnames(adni)[c(43:104)]\ncovariates <- c(\"timedays\", \"AGE\", \"SEX\", \"DIAGNOSIS\")\ninteraction <- c(\"timedays,DIAGNOSIS\")\nbatch <- \"manufac\"\nresult_lmer <- visual_prep(type = \"lmer\", features = features, batch = batch, covariates = covariates, interaction = interaction, smooth = NULL, random = \"subid\", df = adni)\ncomfam_shiny(result_lmer)\n```\n:::\n\n:::\n\nAlternatively, users can utilize the command-line interface via **ComBatQC_CLI.R**. The essential steps have been streamlined, significantly simplifying the workflow and making it easier to get started. The following parameters must be assigned values:\n\n-   `--diagnosis/-d`: TRUE (by default)\n-   `--visualization/-v`: TRUE (by default)\n-   `--features/-f`: position of features/rois data (column numbers)\n-   `--covariates/-c`: column position of the covariates whose effects should be preserved\n-   `--batch/-b`: column position of the batch variable\n-   `--smooth/-s`:  column position of the smooth term (if a gam model is used)\n-   `--random/-r`: column position of the random effect term (if a lmer model is used)\n\n::: {.callout-tip collapse=\"true\"}\n## CLI code\n\n::: {.cell}\n\n```{.bash .cell-code}\nRscript path/to/combatQC_CLI.R path/to/unharmonized_data.csv -d TRUE -v TRUE --features 43-104 --covariates 9,11,13-14 -b 16 -i 9*14 -r 3 -m lmer \n```\n:::\n\n:::\n\n## Data Overview\n\n::: {#fig-cern}\n\n\n{{< video https://youtu.be/5OJU4oVZ6Ow >}}\n\n\n\nComBatFamQC: Data Overview\n\n:::\n\n## Summary\n\n::: {#fig-cern}\n\n\n{{< video https://youtu.be/cLI9WkCPLF8 >}}\n\n\n\nComBatFamQC: Summary\n\n:::\n\n## Residial Plot\n\n::: {#fig-cern}\n\n\n{{< video https://youtu.be/EME2-E3UEXI >}}\n\n\n\nComBatFamQC: Residual Plot\n\n:::\n\n## Diagnosis of Global Batch Effect\n\n::: {#fig-cern}\n\n\n{{< video https://youtu.be/-CDK0qx5_xI >}}\n\n\n\nComBatFamQC: Diagnosis of Global Batch Effect\n\n:::\n\n## Diagnosis of Individual Batch Effect\n\n::: {#fig-cern}\n\n\n{{< video https://youtu.be/UBTw3REUlSw >}}\n\n\n\nComBatFamQC: Diagnosis of Individual Batch Effect\n\n:::\n\n## Interactive Harmonization\n\n::: {#fig-cern}\n\n\n{{< video https://youtu.be/CyAxIY9Cagk >}}\n\n\n\nComBatFamQC: Interactive Harmonization\n\n:::\n\n\n# Export Batch Effect Diagnosis Result\n___\n\nUsers can save the batch effect diagnosis result using the following code:\n\n::: {.callout-note collapse=\"true\"}\n## R code\n\n::: {.cell}\n\n```{.r .cell-code}\ndiag_save(path = \"path/to/dir\", result = result_lmer)\n```\n:::\n\n:::\n\nUsing the command-line interface requires users to set the following parameter:\n\n-   `--visualization/-v`: FALSE\n-   `--outdir`: Path to a directory for saving the batch effect diagnosis result\n\n::: {.callout-tip collapse=\"true\"}\n## CLI code\n\n::: {.cell}\n\n```{.bash .cell-code}\nRscript path/to/combatQC_CLI.R path/to/unharmonized_data.csv -d TRUE -v FALSE --features 43-104 --covariates 9,11,13-14 -b 16 -i 9*14 -r 3 -m lmer --outdir /path/to/dir\n```\n:::\n\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}